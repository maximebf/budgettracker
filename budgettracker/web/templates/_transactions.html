{% macro transaction(tx, is_planned=False) -%}
  <li data-tx-id="{{tx.id}}" data-tx-amount="{{tx.amount}}" data-tx-date="tx.date.isoformat()">
    <span class="date">{{tx.date.strftime('%d %b')}}</span>
    <span class="label" title="{{tx.label}}">{{tx.label}}</span>
    {% if tx.goal %}
      <span class="goal" title="{{tx.goal}}" onclick="showTransactionOptions(event)">&#9733;</span>
    {% endif %}
    {% if tx.categories %}
      {% for category in tx.categories %}
        <span class="category" title="{{category}}" style="background-color: {{category_colors.get(category) or '#eee'}}"
          onclick="showTransactionOptions(event)">{{category}}</span>
      {% endfor %}
    {% else %}
      <span class="category" onclick="showTransactionOptions(event)"></span>
    {% endif %}
    <span class="amount {{ 'warn' if is_planned else ('pos' if tx.amount >= 0 else 'neg') }}">{{famount(tx.amount)}}</span>
  </li>
{%- endmacro %}

<ul class="transactions">
  {% for tx in budget.transactions[:10] %}
    {{ transaction(tx, tx in budget.planned_expenses_transactions) }}
  {% endfor %}
</ul>
{% if budget.transactions|length > 10 %}
<a id="show-more" href="javascript:" onclick="showAllTransactions()">more</a>
<ul class="transactions hidden">
  {% for tx in budget.transactions[10:] %}
    {{ transaction(tx, tx in budget.planned_expenses_transactions) }}
  {% endfor %}
</ul>
{% endif %}